---
RecipeFormatVersion: "2020-01-25"
ComponentName: _MultiPlatform_
ComponentVersion: "1.0.0"
ComponentConfiguration:
  DefaultConfiguration:
    Message: "World"
ComponentDescription: Hello World App for Evergreen
ComponentPublisher: GG UAT
Manifests:
  - Platform:
      os: "linux"
      runtime: "*"
    Selections:
      - unix
    Artifacts:
      - URI: s3://$bucketName$/$testArtifactsDirectory$/$randomId$/hello_world.py
    Lifecycle:
      run: |-
        while true; do
        python3 {artifacts:path}/hello_world.py '{configuration:/Message}'; sleep 5
        done

  - Platform:
      os: windows
    Artifacts:
      - URI: s3://$bucketName$/$testArtifactsDirectory$/$randomId$/hello_world.py
    Selections:
      - windows
  - Platform:
      os: customOs
    Selections:
      - custom
  - Platform:
      os: manifestOverridingLifecycle
    Lifecycle:
      run: |-
        echo overriding global lifecycle
  # default platform when no match found
  - Artifacts:
      - URI: s3://$bucketName$/$testArtifactsDirectory$/$randomId$/hello_world.py

Lifecycle:
  linux:
    run: |-
      while true; do
      python3 {artifacts:path}/hello_world.py '{configuration:/Message}'; sleep 5
      done
  windows:
    run:>- powershell -command "& { while(1) { python
    {artifacts:path}/hello_world.py \"{configuration:/Message}\"; sleep 5 } }"
  custom: run:|- echo Hello {configuration:/Message} from custom platform!
  all: run:|- echo fallback to default platform
