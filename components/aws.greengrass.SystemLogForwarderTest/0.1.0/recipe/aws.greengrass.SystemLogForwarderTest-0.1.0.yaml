# aws-greengrass-system-log-forwarder - AWS Greengrass component for forwarding
# logs to CloudWatch.
# Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
# SPDX-License-Identifier: Apache-2.0
---
RecipeFormatVersion: "2020-01-25"
ComponentName: "aws.greengrass.SystemLogForwarderTest"
ComponentVersion: "0.1.0"
ComponentType: "aws.greengrass.generic"
ComponentDescription:
  "A generic component which uploads system logs to CloudWatch."
ComponentPublisher: "AWS"
ComponentConfiguration:
  DefaultConfiguration:
    maxUploadIntervalSec: "300"
    bufferCapacity: "1048576"
    logGroup: "greengrass/systemLogs"
    logStream: ""
    filters:
      services:
        - "ggl.*"
ComponentDependencies:
  aws.greengrass.TokenExchangeService:
    VersionRequirement: ">=2.0.0"
    DependencyType: "HARD"
Manifests:
  - Platform:
      os: "linux"
      runtime: "aws_nucleus_lite"
      architecture: "aarch64"
    Lifecycle:
      run:
        Script: "{artifacts:path}/system-log-forwarder-arm64
          --maxUploadIntervalSec\
          \ {configuration:/maxUploadIntervalSec} --bufferCapacity
          {configuration:/bufferCapacity}\
          \ --logGroup {configuration:/logGroup} --logStream
          \"{configuration:/logStream}\"\
          \ --thingName {iot:thingName} --filters {configuration:/filters}"
        RequiresPrivilege: "true"
    Artifacts:
      - Uri: s3://$bucketName$/$testArtifactsDirectory$/system-log-forwarder-arm64
        Unarchive: "NONE"
        Permission:
          Read: "OWNER"
          Execute: "OWNER"
  - Platform:
      os: "linux"
      runtime: "aws_nucleus_lite"
      architecture: "amd64"
    Lifecycle:
      run:
        Script: "{artifacts:path}/system-log-forwarder-x86_64
          --maxUploadIntervalSec\
          \ {configuration:/maxUploadIntervalSec} --bufferCapacity
          {configuration:/bufferCapacity}\
          \ --logGroup {configuration:/logGroup} --logStream
          \"{configuration:/logStream}\"\
          \ --thingName {iot:thingName} --filters {configuration:/filters}"
        RequiresPrivilege: "true"
    Artifacts:
      - Uri: s3://$bucketName$/$testArtifactsDirectory$/system-log-forwarder-x86_64
        Unarchive: "NONE"
        Permission:
          Read: "OWNER"
          Execute: "OWNER"
Lifecycle: {}
